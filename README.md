# Реферальная система

Этот проект реализует систему авторизации пользователей по номеру телефона и инвайт-кодами без генерации кода для верификации номера телефона в данной ветке. Также реализованы профили пользователей и возможность активации инвайт-кодов.

> [!NOTE]
> Так как консоль недоступна пользователям, убрана верификация по коду.

## Стек технологий

- **Python 3.12**
- **Django 4.2**
- **Django REST Framework (DRF)**
- **PostgreSQL**
- **Docker**

## Функционал

1. **Авторизация по номеру телефона**
    - Первый запрос: Пользователь вводит свой номер телефона.
    - Если пользователь не авторизовывался ранее, создается запись в базе данных с его номером телефона и уникальным 6-значным реферальным кодом.

2. **Инвайт-коды**
    - Пользователь может ввести чужой инвайт-код в своем профиле.
    - Пользователь может активировать только один инвайт-код. Если инвайт-код уже был активирован, он будет отображен в профиле.
    - В профиле пользователя отображается список номеров телефонов, которые использовали его инвайт-код.

3. **Профиль пользователя**
    - Запрос на получение профиля пользователя.
    - Профиль содержит информацию о статусе инвайт-кода и список пользователей, которые использовали инвайт.
    - Содержит поле для валидации чужого инвайт-кода, кнопку для применения и кнопку для выхода из системы.

## Установка и запуск на своем сервере

### 1. Клонировать репозиторий

```bash
git clone -b deploy https://github.com/CringeT1Me/referral_code/
cd referral_core
```
### 2. Запустить Docker
```bash
docker compose up --build
```

## Пути

### Вход в систему

#### localhost:8000/login/

- **Описание**: Форма для входа в систему по номеру телефона.

### Список пользователей

#### localhost:8000/users/?page=1/
- **Параметры**:
  - `page`: Страница списка пользователей. Необязателен для первой страницы.
- **Описание**: Форма для просмотра списка пользователей, использующая TemplateHTMLRenderer от DRF.

### Профиль пользователя

#### localhost:8000/users/{id}/

- **Описание**: Форма профиля пользователя, использующая TemplateHTMLRenderer от DRF. Инвайт-код можно ввести только в своем профиле.

---

## API

Документация доступна по ссылкам

 - [ReDoc](http://testslink.ru/redoc/)
 - [Swagger](http://testslink.ru/swagger/)

### Вход в систему

####`POST /api/v1/login/`

- **Ссылка:**: http://testslink.ru/api/v1/login/
- **Описание**: Отправка SMS с кодом подтверждения на указанный номер телефона.
- **Параметры**:
  - `data` (body):
    - `phone_number`: Номер телефона пользователя.
- **Ответы**:
  - `200`: Успешный вход.
  - `400`: Ошибка валидации данных.

---

### Выход из системы

#### `POST /api/v1/logout/`

- **Ссылка:**: http://testslink.ru/api/v1/logout/
- **Описание**: Завершает текущую сессию пользователя.
- **Ответы**:
  - `200`: Успешный выход из системы.
---

### Список пользователей

#### `GET /api/v1/users/?page={int}`

- **Ссылка:**: http://testslink.ru/api/v1/users/?page=1/
- **Параметры**:
  - `page`: Страница списка пользователей. Необязателен для первой страницы.
- **Описание**: Возвращает список из пользователей, входящих в диапазон пагинации (10 пользователей на страницу). 
- **Ответы**:
  - `200`: Список пользователей.
  - `403`: Пользователь не авторизован.
  - `404`: Страница не найдена.
---

### Профиль пользователя

#### `GET /api/v1/users/{id}/`

- **Ссылка:**: http://testslink.ru/api/v1/users/1/
- **Описание**: Возвращает профиль конкретного пользователя по его ID.
- **Параметры**:
  - `id`: Уникальный идентификатор пользователя.
- **Ответы**:
  - `200`: Детали пользователя.
  - `403`: Пользователь не авторизован.
  - `404`: Пользователь не найден.
---

### Валидировать реферальный код

#### `GET /api/v1/users/validate-referral/{referral_code}/`

- **Ссылка:**: http://testslink.ru/api/v1/users/validate-referral/AAAAAA/
- **Описание**: Проверяет, доступен ли указанный реферальный код.
- **Параметры**:
  - `referral_code`: Реферальный код для проверки.
- **Ответы**:
  - `200`: Код доступен.
  - `400`: Неверный код или код уже активирован.
  - `403`: Пользователь не авторизован.
---

### Применение реферального кода

#### `POST /api/v1/users/apply-referral/`

- **Ссылка:**: http://testslink.ru/api/v1/users/apply-referral/
- **Описание**: Позволяет пользователю активировать реферальный код.
- **Параметры**:
  - `data` (body):
    - `referral_code`: Реферальный код для активации.
- **Ответы**:
  - `200`: Код успешно применен.
  - `400`: Ошибка валидации.
  - `403`: Пользователь не авторизован.




